---
# Registers a pubkey for a user on a server, to allow passwordless login
# ('host' and 'user' must be specified)

- hosts: '{{ host }}'
  sudo: True

  vars_prompt:
    - name: pubkey
      prompt: "Please paste the pubkey"

  tasks:
  - name: Add RSA key to the remote host
    authorized_key: "user='{{ user }}' key='{{ pubkey }}' state=present"
    notify:
    - restart ssh

  handlers:
    - name: restart ssh
      service: name=ssh state=restarted
